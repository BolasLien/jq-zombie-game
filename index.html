<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #game {
            width: 1440px;
            height: 900px;
            background: #000;
            margin: auto;
            position: relative;
            overflow: hidden;
        }

        #panel {
            position: absolute;
            height: 900px;
        }

        .scene {
            width: 1440px;
            height: 900px;
            float: left;
        }

        #scene1 {
            background: url(./scene/00.jpg);
        }

        #scene2 {
            background: url(./scene/02.jpg);
        }

        #scene3 {
            background: url(./scene/02.jpg);
        }

        #scene4 {
            background: url(./scene/03.jpg);
        }

        #scene5 {
            background: url(./scene/04.jpg);
        }

        input[type="button"] {
            width: 120px;
            height: 40px;
        }

        #game img {
            position: absolute;
            height: 150px;

        }

        #controller {
            margin: auto;
            height: 40px;
            width: 1440px;
            background: #fff;
        }
    </style>
</head>

<body>
    <div id="game">
        <div id="controller">
            <input type="button" value="遊戲開始" id="start-btn">
            <input type="button" value="結束遊戲" id="over-btn">
            <span>分數：<span id="text-score">0</span></span>
            <span>剩餘時間：<span id="text-time">10</span>秒</span>
            <span>生命值：<span id="text-life">10</span></span>
        </div>
        <div id="panel">
            <div class="scene" id="scene1"></div>
            <div class="scene" id="scene2"></div>
            <div class="scene" id="scene3"></div>
            <div class="scene" id="scene4"></div>
            <div class="scene" id="scene5"></div>
        </div>
    </div>


    <script src="jquery-3.5.0.min.js"></script>
    <script>
        $(function () {

            // 分數
            let score = 0;
            // 剩餘時間
            let timeleft = 30;
            // 遊戲計時器
            let gametimer = 0;
            // 殭屍流水號
            let itemid = 0;
            //玩家生命
            let life = 10;


            // 畫面大小
            let now = 0;
            const sl = $(".scene").length;
            $("#panel").css("width", sl * 1440);

            // 換頁功能
            const sceneChange = (Num) => {
                now = Num;
                const move = now * 1440;
                $("#panel").stop(true, true)
                $("#panel").animate({ left: `-${move}px` }, 1000)
            }

            const rand = (num) => {
                return Math.round(Math.random() * num);
            }

            const gameOver = () => {
                clearInterval(gametimer);
                // 啟用開始按鈕
                $("#start-btn").attr("disabled", false);

                // 清場
                $("#game img").remove();
                itemid = 0;
                sceneChange(0)
            }

            $("#over-btn").click(function () {
                gameOver();
            })

            //遊戲開始按鈕
            $("#start-btn").click(function () {
                sceneChange(1)

                // 停用開始按鈕
                $(this).attr("disabled", true);

                // 重設
                score = 0;
                $("#text-score").text(score);
                timeleft = 30;
                $("#text-time").text(timeleft);
                life = 10;
                $("#text-life").text(life);

                // 遊戲倒數
                gametimer = setInterval(() => {
                    // 倒數
                    timeleft--;
                    $("#text-time").text(timeleft);

                    if (timeleft == 0 || life == 0) {
                        setTimeout(() => {
                            alert("遊戲結束");
                        }, 100);
                        gameOver();
                    }
                    else {

                        createItem();
                    }

                }, 1000);


            })

            //創建一個東西
            const createItem = () => {
                const r = rand(100);
                let src = "";
                let name = "";


                if (r > 10 && r <= 30) {
                    //fat
                    src = "./fat.gif"
                    name = "fat";
                }
                else if (r > 31 && r <= 40) {
                    //hunter
                    src = "./hunter.gif"
                    name = "hunter";

                }
                else if (r > 41 && r <= 70) {
                    //joker
                    src = "./joker.gif"
                    name = "joker";

                }
                else if (r > 71 && r <= 80) {
                    //witch-run
                    src = "./witch.gif"
                    name = "witch";

                }
                else if (r > 81 && r <= 90) {
                    //tank
                    src = "./tank.gif"
                    name = "tank";

                }
                else {
                    //other
                    src = "./life.png"
                    name = "life";
                }

                src = "./joker.gif"
                name = "joker";
                $(`#panel`).append(`<img src=${src} id=item${itemid} class=${name}>`);
                setItemPosition($(`#item${itemid}`));
                if (isEnemy($(`#item${itemid}`))) {
                    moveEnemy($(`#item${itemid}`))
                }
                itemid++;
            }

            const isEnemy = (item) => {
                return item.hasClass("fat") || item.hasClass("tank") || item.hasClass("witch") || item.hasClass("joker") || item.hasClass("hunter");
            }

            const getItemName = (item) => {
                let name = "";

                if (item.hasClass("fat")) { name = "fat"; }
                else if (item.hasClass("tank")) { name = "tank"; }
                else if (item.hasClass("witch")) { name = "witch"; }
                else if (item.hasClass("joker")) { name = "joker"; }
                else if (item.hasClass("hunter")) { name = "hunter"; }
                else if (item.hasClass("life")) { name = "life"; }

                return name;
            }

            const setItemPosition = (item) => {
                console.log(getItemName(item));
                switch (getItemName(item)) {
                    case "fat":
                        item.css({
                            bottom: `${rand(200) + 400}px`,
                            left: `${(1440 * now) + rand(400)}px`
                        })
                        break;
                    case "tank":
                        item.css({
                            bottom: `${rand(200)}px`,
                            left: `${(1440 * now) + rand(1000)}px`
                        })
                        break;
                    case "witch":
                        item.css({
                            bottom: `${rand(200)}px`,
                            left: `${(1440 * now) + rand(1000)}px`
                        })
                        break;
                    case "joker":
                        item.css({
                            bottom: `${150 + rand(200)}px`,
                            left: `${(1440 * now) + 1000 + rand(200)}px`
                        })
                        break;
                    case "hunter":
                        item.css({
                            bottom: `${rand(200)}px`,
                            left: `${(1440 * now) + 1000 + rand(200)}px`
                        })
                        break;
                    case "life":
                        item.css({
                            bottom: `${rand(200)}px`,
                            left: `${(1440 * now) + rand(1000)}px`
                        })
                        break;
                }

            }

            const moveEnemy = (enemy) => {
                switch (getItemName(enemy)) {
                    case "fat":
                        enemy.animate({
                            bottom: `-${rand(100)}px`,
                            left: `${(1440 * now) + rand(1000)}px`,
                            height: `+=300px`
                        }, 3000, function () {
                            atk();
                        })
                        break;
                    case "tank":
                        enemy.animate({
                            height: "+=100px"
                        }, 5000, function () {
                            atk();
                        })
                        break;
                    case "witch":

                        break;
                    case "joker":
                        enemy.animate({
                            bottom: `-${rand(100)}px`,
                            left: `${(1440 * now) + rand(1000)}px`,
                            height: `+=200px`
                        }, 3000, function () {
                            atk();
                        })
                        break;
                    case "hunter":
                        break;
                }
            }

            const atk = () => {
                life--;
                $("#text-life").text(life);

                $(`#panel`).append(`<div style=" backgroun:#f00; width:1440px height:900px;"></div>`);

            }

            //點擊item事件
            $("#game").on("click", "img", function () {
                if (isEnemy($(this))) {
                    $(this).attr("src", "./blood.png")
                    $(this).stop();
                    score++;
                    $("#text-score").text(score);

                }
                else {
                    $(this).remove();
                    $(this).stop();
                    life++;
                    $("#text-life").text(life);
                }


                $(this).css("pointer-events", "none");

            })


        })


    </script>
</body>

</html>